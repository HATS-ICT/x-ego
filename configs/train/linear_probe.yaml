# Stage 2: Linear Probing on Downstream Tasks
# Uses frozen encoder from Stage 1 contrastive learning

meta:
  run_name: probe-${task.task_id}-${model.encoder.video.model_type}
  fast_dev_run: false
  resume_exp: null

# Task configuration - override these per task
# See task_definitions.csv for all available tasks
task:
  task_id: self_location  # e.g., self_location, enemy_location, global_anyKill_5s
  ml_form: multi_cls      # binary_cls, multi_cls, multi_label_cls, regression
  num_classes: 23         # Number of classes (for classification tasks)
  output_dim: 23          # Output dimension
  label_column: place     # Column name in CSV containing labels

data:
  labels_filename: linear_probe_labels.csv  # Override per task
  use_precomputed_embeddings: true

model:
  # Stage 1 checkpoint to load encoder weights from
  stage1_checkpoint: null  # Set to path of Stage 1 checkpoint
  
  # Freeze encoder (video projector) - typically true for linear probing
  freeze_encoder: true
  
  # Agent fusion for multi-agent setup
  agent_fusion:
    method: mean  # Simple mean pooling for linear probing
    fused_agent_dim: 768

training:
  max_epochs: 20  # Linear probing typically needs fewer epochs

optimization:
  lr: 0.001  # Higher LR for linear probing
  weight_decay: 0.0  # No weight decay for linear probe

checkpoint:
  epoch:
    filename: ${meta.run_name}-e{epoch:02d}-l{val/loss:.4f}
    monitor: 'val/loss'
    mode: min
    save_top_k: 1
    save_last: true
    auto_insert_metric_name: false
    save_on_train_epoch_end: true
    every_n_epochs: 1
